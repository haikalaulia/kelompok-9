<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Login dan Registrasi</title>
</head>

<body>
    <div class="container">
        <div id="loginForm">
            <h1>Login</h1>
            <form onsubmit="return handleLogin(event)">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
                <button type="submit" id="button-login">Login</button>
                <div class="response"></div>
            </form>
            <p>Belum punya akun? <a href="#" onclick="toggleForms('register')">Registrasi di sini</a></p>
        </div>

        <div id="register" class="hidden">
            <h1>Registrasi</h1>
            <form onsubmit="return handleRegister(event)">
                <label for="regUsername">Username:</label>
                <input type="text" id="regUsername" name="regUsername" required>
                <label for="regPassword">Password:</label>
                <input type="password" id="regPassword" name="regPassword" required>
                <button type="submit" id="btn-regis">Registrasi</button>
            </form>
            <p>Sudah punya akun? <a href="#" onclick="toggleForms('login')">Login di sini</a></p>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script>
        function toggleForms(form) {
            const loginForm = document.getElementById('loginForm');
            const registerDiv = document.getElementById('register');

            if (form === 'register') {
                loginForm.classList.add('hidden');
                registerDiv.classList.remove('hidden');
            } else {
                loginForm.classList.remove('hidden');
                registerDiv.classList.add('hidden');
            }
        }

        function handleLogin(event) {
            event.preventDefault(); // Mencegah pengiriman form
            // Ambil data dari form

            var username = $("#username").val();
            var password = $("#password").val();
            if (!username || !password) {
                return alert("password harus disi")
            }

            // AJAX Request
            $.ajax({
                url: 'http://localhost/UTS_prak/API/login.php', // URL tempat mengirim data
                type: 'POST',      // Menggunakan metode POST
                dataType: "json",
                data: {
                    username: username,
                    password: password
                },

                beforeSend: function () {
                    var buttonLogin = $("#button-login");
                    buttonLogin.text("mohon tunggu")
                },
                
                success: function (response) {
                    console.log(response);
                    var buttonLogin = $("#button-login");
                    buttonLogin.text("Login")
                    if (response) {
                        localStorage.setItem("username", response.username);
                        // Menampilkan respon dari server
                        window.location.href = 'todo.html'; // Arahkan ke halaman To-Do List
                    } else {
                        // Jika ada error saat request
                        $('.response').html("user atau password salah");
                    }

                },
                error: function (xhr, status, error) {
                    var buttonLogin = $("#button-login");
                    buttonLogin.text("Login")
                    // Jika ada error saat request
                    $('.response').html('Error: ' + xhr.status + ' ' + error);
                }
            });

            // // Logika login bisa ditambahkan di sini (misalnya, validasi)
            // window.location.href = 'todo.html'; // Arahkan ke halaman To-Do List
        }

        function handleRegister(event) {
            event.preventDefault(); // Mencegah pengiriman form
            // Ambil data dari form

            var username = $("#regUsername").val();
            var password = $("#regPassword").val();
            if (!username || !password) {
                return alert("password harus disi")
            }

            // AJAX Request
            $.ajax({
                url: 'http://localhost/UTS_prak/API/regis.php', // URL tempat mengirim data
                type: 'POST',      // Menggunakan metode POST
                dataType: "json",
                data: {
                    username: username,
                    password: password
                },

                beforeSend: function () {
                    var btnRegis = $("#btn-regis");
                    btnRegis.text("mohon tunggu")
                },

                success: function (response) {
                    var btnRegis = $("#btn-regis");
                    btnRegis.text("Registrasi")
                    if (response) {
                        toggleForms("");
                    } else {
                        // Jika ada error saat request
                        $('.response').html("gagal registrasi");
                    }

                },
                error: function (xhr, status, error) {
                    var btnRegis = $("#btn-regis");
                    btnRegis.text("Registrasi")
                    // Jika ada error saat request
                    $('.response').html('Error: ' + xhr.status + ' ' + error);
                }
            });

        }
    </script>
</body>

</html>